<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quick Translator - Thai â†” English</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #1a1a2e;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: #ffffff;
            border-radius: 16px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
            width: 100%;
            max-width: 800px;
            padding: 48px;
        }

        h1 {
            text-align: center;
            color: #1a1a2e;
            margin-bottom: 32px;
            font-size: 1.75rem;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .api-key-section {
            background: #f8fafc;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 32px;
            border: 1px solid #e2e8f0;
        }

        .api-key-section label {
            display: block;
            margin-bottom: 8px;
            color: #475569;
            font-weight: 600;
            font-size: 14px;
        }

        .api-key-section input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s, box-shadow 0.2s;
            background: white;
        }

        .api-key-section input:focus {
            outline: none;
            border-color: #0f172a;
            box-shadow: 0 0 0 3px rgba(15, 23, 42, 0.1);
        }

        .api-key-section .hint {
            font-size: 12px;
            color: #64748b;
            margin-top: 6px;
        }

        .language-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
        }

        .lang-btn {
            padding: 10px 24px;
            border: 2px solid #0f172a;
            background: white;
            color: #0f172a;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .lang-btn.active {
            background: #0f172a;
            color: white;
        }

        .lang-btn:hover:not(.active) {
            background: #f1f5f9;
        }

        .swap-btn {
            background: #0f172a;
            color: white;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: transform 0.2s, background 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .swap-btn:hover {
            transform: rotate(180deg);
            background: #1e293b;
        }

        .translation-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .text-box {
            display: flex;
            flex-direction: column;
        }

        .text-box label {
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        .text-box textarea {
            flex: 1;
            min-height: 200px;
            padding: 16px;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            font-size: 15px;
            resize: vertical;
            font-family: inherit;
            transition: border-color 0.2s, box-shadow 0.2s;
            background: white;
        }

        .text-box textarea:focus {
            outline: none;
            border-color: #0f172a;
            box-shadow: 0 0 0 3px rgba(15, 23, 42, 0.1);
        }

        .text-box.output {
            position: relative;
        }

        .text-box.output textarea {
            background: #f8fafc;
            padding-right: 50px;
        }

        .copy-btn {
            position: absolute;
            top: 38px;
            right: 12px;
            background: #0f172a;
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s, transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .copy-btn:hover {
            background: #1e293b;
            transform: scale(1.05);
        }

        .copy-btn.copied {
            background: #22c55e;
        }

        .translate-btn {
            width: 100%;
            padding: 14px;
            background: #0f172a;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s, transform 0.2s;
        }

        .translate-btn:hover:not(:disabled) {
            background: #1e293b;
            transform: translateY(-1px);
        }

        .translate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .translate-btn.loading {
            position: relative;
            color: transparent;
        }

        .translate-btn.loading::after {
            content: '';
            position: absolute;
            width: 24px;
            height: 24px;
            top: 50%;
            left: 50%;
            margin-top: -12px;
            margin-left: -12px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error {
            background: #fee;
            color: #c33;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .error.show {
            display: block;
        }

        .button-row {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .clear-btn {
            flex: 1;
            padding: 14px;
            background: #64748b;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s, transform 0.2s;
        }

        .clear-btn:hover {
            background: #475569;
            transform: translateY(-1px);
        }

        .history-section {
            margin-top: 32px;
            border-top: 1px solid #e2e8f0;
            padding-top: 24px;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .history-header h2 {
            font-size: 1.1rem;
            color: #1a1a2e;
            font-weight: 700;
        }

        .clear-history-btn {
            padding: 6px 12px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .clear-history-btn:hover {
            background: #dc2626;
        }

        .history-list {
            max-height: 300px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .history-item {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 12px;
            cursor: pointer;
            transition: background 0.2s, border-color 0.2s;
        }

        .history-item:hover {
            background: #f1f5f9;
            border-color: #0f172a;
        }

        .history-direction {
            font-size: 11px;
            color: #0f172a;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .history-time {
            font-size: 11px;
            color: #64748b;
        }

        .history-text {
            font-size: 14px;
            color: #1e293b;
            margin-bottom: 4px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .history-text.output {
            color: #64748b;
            font-style: italic;
        }

        .history-empty {
            text-align: center;
            color: #64748b;
            padding: 20px;
            font-style: italic;
        }

        @media (max-width: 768px) {
            .container {
                padding: 24px;
            }

            .translation-area {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Quick Translator</h1>
        
        <div class="api-key-section">
            <label for="apiKey">OpenTyphoon API Key</label>
            <input type="password" id="apiKey" placeholder="Enter your API key" />
            <div class="hint">Your API key is saved locally in your browser</div>
        </div>

        <div class="language-toggle">
            <button class="lang-btn active" id="langBtn">Thai â†’ English</button>
            <button class="swap-btn" id="swapBtn" title="Swap languages">â‡„</button>
        </div>

        <div class="translation-area">
            <div class="text-box">
                <label for="inputText">Thai</label>
                <textarea id="inputText" placeholder="Enter text to translate..."></textarea>
            </div>
            <div class="text-box output">
                <label for="outputText">English</label>
                <textarea id="outputText" placeholder="Translation will appear here..." readonly></textarea>
                <button class="copy-btn" id="copyBtn" title="Copy translation">ðŸ“‹</button>
            </div>
        </div>

        <div class="error" id="error"></div>

        <div class="button-row">
            <button class="translate-btn" id="translateBtn">Translate</button>
            <button class="clear-btn" id="clearBtn">Clear</button>
        </div>

        <div class="history-section">
            <div class="history-header">
                <h2>Translation History</h2>
                <button class="clear-history-btn" id="clearHistoryBtn">Clear History</button>
            </div>
            <div class="history-list" id="historyList">
                <div class="history-empty">No translations yet</div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'https://api.opentyphoon.ai/v1/chat/completions';
        const MODEL = 'typhoon-v2.5-30b-a3b-instruct';
        const TEMPERATURE = 0.7;
        const MAX_TOKENS = 4000;

        const apiKeyInput = document.getElementById('apiKey');
        const langBtn = document.getElementById('langBtn');
        const swapBtn = document.getElementById('swapBtn');
        const inputText = document.getElementById('inputText');
        const outputText = document.getElementById('outputText');
        const translateBtn = document.getElementById('translateBtn');
        const copyBtn = document.getElementById('copyBtn');
        const clearBtn = document.getElementById('clearBtn');
        const clearHistoryBtn = document.getElementById('clearHistoryBtn');
        const historyList = document.getElementById('historyList');
        const errorDiv = document.getElementById('error');

        let isThaiToEnglish = true;
        let translationHistory = [];

        // Load API key from localStorage
        const savedApiKey = localStorage.getItem('opentyphoon_api_key');
        if (savedApiKey) {
            apiKeyInput.value = savedApiKey;
        }

        // Load translation history from localStorage
        const savedHistory = localStorage.getItem('translation_history');
        if (savedHistory) {
            translationHistory = JSON.parse(savedHistory);
            renderHistory();
        }

        // Save API key on change
        apiKeyInput.addEventListener('input', () => {
            localStorage.setItem('opentyphoon_api_key', apiKeyInput.value);
        });

        // Swap languages
        swapBtn.addEventListener('click', () => {
            isThaiToEnglish = !isThaiToEnglish;
            updateLanguageLabels();
            
            // Swap text content
            const tempText = inputText.value;
            inputText.value = outputText.value;
            outputText.value = tempText;
        });

        function updateLanguageLabels() {
            const inputLabel = document.querySelector('.text-box:first-child label');
            const outputLabel = document.querySelector('.text-box.output label');
            
            if (isThaiToEnglish) {
                langBtn.textContent = 'Thai â†’ English';
                inputLabel.textContent = 'Thai';
                outputLabel.textContent = 'English';
                inputText.placeholder = 'Enter Thai text to translate...';
            } else {
                langBtn.textContent = 'English â†’ Thai';
                inputLabel.textContent = 'English';
                outputLabel.textContent = 'Thai';
                inputText.placeholder = 'Enter English text to translate...';
            }
        }

        function showError(message) {
            errorDiv.textContent = message;
            errorDiv.classList.add('show');
            setTimeout(() => {
                errorDiv.classList.remove('show');
            }, 5000);
        }

        async function translate() {
            const apiKey = apiKeyInput.value.trim();
            const text = inputText.value.trim();

            if (!apiKey) {
                showError('Please enter your OpenTyphoon API key');
                return;
            }

            if (!text) {
                showError('Please enter text to translate');
                return;
            }

            translateBtn.disabled = true;
            translateBtn.classList.add('loading');
            outputText.value = '';

            const systemPrompt = isThaiToEnglish
                ? 'You are a professional translator specializing in Thai-English translation. Translate the given Thai text into natural, fluent English that sounds like a native speaker. Follow these guidelines:\n\n1. Use idiomatic English expressions and natural phrasing instead of literal word-for-word translations\n2. Maintain the original tone (formal, casual, polite, etc.) and emotional nuance\n3. Preserve the meaning accurately while making it flow naturally in English\n4. Use appropriate English sentence structures and word order\n5. Handle cultural references appropriately - explain or adapt them when necessary for clarity\n6. For formal contexts, use professional English; for casual contexts, use conversational English\n7. Provide ONLY the translation, no explanations or notes'
                : 'You are a professional translator specializing in English-Thai translation. Translate the given English text into natural, fluent Thai that sounds like a native speaker. Follow these guidelines:\n\n1. Use natural Thai expressions and idioms instead of literal translations\n2. Use appropriate male politeness particle (à¸„à¸£à¸±à¸š) based on the context and formality level\n3. Maintain the original tone (formal, casual, polite, etc.) and emotional nuance\n4. Preserve the meaning accurately while making it flow naturally in Thai\n5. Use proper Thai sentence structures and word order\n6. Handle cultural references appropriately - adapt them for Thai context when needed\n7. For formal contexts, use formal Thai language; for casual contexts, use conversational Thai\n8. Provide ONLY the translation, no explanations or notes';

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: MODEL,
                        messages: [
                            {
                                role: 'system',
                                content: systemPrompt
                            },
                            {
                                role: 'user',
                                content: text
                            }
                        ],
                        temperature: TEMPERATURE,
                        max_tokens: MAX_TOKENS
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.error?.message || `API error: ${response.status}`);
                }

                const data = await response.json();
                const translation = data.choices?.[0]?.message?.content || 'No translation received';
                outputText.value = translation.trim();
                
                // Save to history
                saveToHistory(text, translation.trim());

            } catch (error) {
                showError(`Translation failed: ${error.message}`);
            } finally {
                translateBtn.disabled = false;
                translateBtn.classList.remove('loading');
            }
        }

        translateBtn.addEventListener('click', translate);

        // Allow Enter to translate, Shift+Enter for new line
        inputText.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                translate();
            }
        });

        // Copy translation
        copyBtn.addEventListener('click', async () => {
            const text = outputText.value.trim();
            if (!text) {
                showError('No translation to copy');
                return;
            }

            try {
                await navigator.clipboard.writeText(text);
                copyBtn.textContent = 'âœ“';
                copyBtn.classList.add('copied');
                
                setTimeout(() => {
                    copyBtn.textContent = 'ðŸ“‹';
                    copyBtn.classList.remove('copied');
                }, 2000);
            } catch (error) {
                showError('Failed to copy to clipboard');
            }
        });

        // Clear text areas
        clearBtn.addEventListener('click', () => {
            inputText.value = '';
            outputText.value = '';
        });

        // Clear history
        clearHistoryBtn.addEventListener('click', () => {
            if (confirm('Are you sure you want to clear all translation history?')) {
                translationHistory = [];
                localStorage.removeItem('translation_history');
                renderHistory();
            }
        });

        // Save translation to history
        function saveToHistory(input, output) {
            const historyItem = {
                id: Date.now(),
                input: input,
                output: output,
                direction: isThaiToEnglish ? 'TH â†’ EN' : 'EN â†’ TH',
                timestamp: new Date().toISOString()
            };
            
            translationHistory.unshift(historyItem);
            
            // Keep only last 50 translations
            if (translationHistory.length > 50) {
                translationHistory = translationHistory.slice(0, 50);
            }
            
            localStorage.setItem('translation_history', JSON.stringify(translationHistory));
            renderHistory();
        }

        // Render history list
        function renderHistory() {
            if (translationHistory.length === 0) {
                historyList.innerHTML = '<div class="history-empty">No translations yet</div>';
                return;
            }
            
            historyList.innerHTML = translationHistory.map(item => {
                const date = new Date(item.timestamp);
                const timeStr = date.toLocaleString();
                
                return `
                    <div class="history-item" data-id="${item.id}">
                        <div class="history-item-header">
                            <span class="history-direction">${item.direction}</span>
                            <span class="history-time">${timeStr}</span>
                        </div>
                        <div class="history-text">${escapeHtml(item.input)}</div>
                        <div class="history-text output">${escapeHtml(item.output)}</div>
                    </div>
                `;
            }).join('');
            
            // Add click handlers to history items
            document.querySelectorAll('.history-item').forEach(item => {
                item.addEventListener('click', () => {
                    const id = parseInt(item.dataset.id);
                    loadFromHistory(id);
                });
            });
        }

        // Load translation from history
        function loadFromHistory(id) {
            const item = translationHistory.find(h => h.id === id);
            if (!item) return;
            
            // Set direction based on history item
            isThaiToEnglish = item.direction === 'TH â†’ EN';
            updateLanguageLabels();
            
            // Load text
            inputText.value = item.input;
            outputText.value = item.output;
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Escape HTML to prevent XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
